\section{Kopplingsschema}

\vspace{-20pt}
Robotens elektronik är uppdelad på två virkort. Därför presenteras här ett kopplingsschema för varje virkort.

\vspace{-20pt}
\subsection{Sensorenhet}
\nyBild{sensor.png}{Kopplingsschema för virkortet som innehåller sensorenheten.}{senskoppling}{1}

\textbf{Komponentförteckning}
\vspace{-10pt}
\begin{packed_enumerate}
\item[1.] Sensorenhetens processor, ATmega1284P
\item[2 \& 3.] 16-kanals multiplexer för linjesensor, HEF4067B
\item[4.] Reflexsensormodul
\item[5 \& 6.] Kontakt för kabel till avståndssensor för sidoskanner, GP2D120
\item[7 \& 8.] Kontakt för kabel till servo för sidoskanner, HS-422
\item[9.] Kontakt för JTAG-kabel
\item[10.] Klockgenerator, EXO-3 20 MHz
\item[11 \& 14.] Resistor för lågpassfilter, 18 k$\Omega$
\item[12 \& 13.] Kondensator för lågpassfilter, 100 nF
\item[15.] Kondensator för reset av Sensorenhet, 4700 nF
\item[16.] Resetknapp för Sensorenhet
\item[17.] Pullup-resistor för reset av Sensorenhet
\item[18.] Kontakt för kabel till RFID-läsare, Parallax Serial Reader
\end{packed_enumerate}

\subsection{Kommunikationsenhet, Armenhet, Chassienhet}
\begin{figure}[H]
\centering
 \includegraphics[angle=90,width=0.85\textwidth]{bilder/chassiarmkomm.png}
  \emph{\caption{Kopplingsschema över virkortet som innehåller kommunikationsenheten, chassienheten och armenheten.} \label{fig:chassiarmkomm}}
  
\end{figure}

\textbf{Komponentförteckning}
\begin{packed_enumerate}
\item[1.] Processor Armenhet, ATmega 1284P
\item[2.] Tri-state buffer, 74LS241
\item[3.] Klockgenerator för Armenhet och Chassienhet, EXO-3 16 MHz  
\item[4.] Kontakt för kabel till armservon
\item[5.] Kontakt för kabel till blåtandsenhet
\item[6.] Pullup-resistor för reset av Kommunikationsenhet och Armenhet, 15 k$\Omega$
\item[7.] Kondensator för reset av Kommunikationsenhet och Armenhet, 4700 nF
\item[8.] Resetknapp för Kommunikationsenhet och Armenhet
\item[9.] Processor Kommunikationsenhet, ATmega 1284P
\item[10.] Skärmenhet för LCD-skärm, JM162A
\item[11.] Resistor för att begränsa strömmen till LCD-skärmens bakgrundsbelysning, 10 $\Omega$
\item[12.] Potentiometer för att justera LCD-skärmens kontrast, 0 - 10 k$\Omega$
\item[13.] Klockgenerator för Kommunikationsenhet, EXO-3 18.432 MHz
\item[14.] Processor för Chassienhet, ATmega 1284P
\item[15.] Pullup-resistor för reset av Chassienhet, 8,2 k$\Omega$
\item[16.] Kondensator för reset av Chassienhet, 4700 nF
\item[17.] Resetknapp för Chassienhet
\item[18.] Omkopplare för att växla mellan autonomt och fjärrstyrt läge
\item[19.] Startknapp för att påbörja autonom drift
\item[20.] Pulldown-resistor för startknappen
\item[21.] Kontakt för kabel till robotchassi, tillför spänning +5 V till virkortet
\item[22.] Kontakt för JTAG-kabel.
\end{packed_enumerate}


\section{Utdrag från programlistning}
\emph{(ca 5-10 sidor så att vi kan bedöma kodens läsbarhet mm.) och eventuell VHDL-kod}

\section{ID:n till buss}
\label{callbacks}

\begin{table}[H]
\centering
\label{callbacks-sensor}
Delsystem sensor
\begin{tabularx}{\textwidth}{|l|l|X|}
\hline
\textbf{ID} & \textbf{Sändning/förfrågan} & \textbf{Funktion [data]} \\ \hline
1 & Oanvänd & \\ \hline
2 & Sändning & Kalibrering av linjesensor \\ \hline
3 & Förfrågan & Linjesensordata \\ \hline
4 & Förfrågan & Tyngdpunkt \\ \hline
5 & Sändning & Sätt tejpreferens [ny tejpreferens] \\ \hline
6 & Oanvänd & \\ \hline
7 & Oanvänd & \\ \hline
8 & Oanvänd & \\ \hline
9 & Sändning & Sätt aktivitet [0 = linjeföljning, 1 = skanna vänster, 2 = skanna höger] \\ \hline
10 & Sändning & Läs RFID-tag \\ \hline
\end{tabularx}
\caption{ID:n samt funktion för delsystem sensor}
\end{table}

Delsystem chassi

\begin{table}[H]
\centering
\label{callbacks-chassi}
\begin{tabularx}{\textwidth}{|l|l|X|}
\hline
\textbf{ID} & \textbf{Sändning/förfrågan} & \textbf{Funktion [data]} \\ \hline
0 & Sändning & Nödstopp \\ \hline
1 & Oanvänd & \\ \hline
2 & Sändning & Arm klar [0 = plockat up, 1 = lagt ner, 2 = hittade inget] \\ \hline
3 & Sändning & Starta linjeföljning \\ \hline
4 & Sändning & RFID inläst \\ \hline
5 & Oanvänd & \\ \hline
6 & Oanvänd & \\ \hline
7 & Oanvänd & \\ \hline
8 & Sändning & Uppdatera manuell styrning, se \ref{packets}\\ \hline
9 & Oanvänd & \\ \hline
10 & Oanvänd & \\ \hline
11 & Sändning & Sätt Kp [nytt värde på Kp] \\ \hline
12 & Sändning & Sätt Kd [nytt värde på Kd] \\ \hline
\end{tabularx}
\caption{ID:n samt funktion för delsystem chassi}
\end{table}

Delsystem kommunikationsenhet

\begin{table}[H]
\centering
\label{callbacks-komm}
\begin{tabularx}{\textwidth}{|l|l|X|}
\hline
\textbf{ID} & \textbf{Sändning/förfrågan} & \textbf{Funktion [data]} \\ \hline
1 & Oanvänd & \\ \hline
2 & Sändning & Rad 1 på skärm för sensorenheten \\ \hline
3 & Sändning & Rad 2 på skärm för sensorenheten \\ \hline
4 & Sändning & Rad 1 på skärm för armenheten \\ \hline
5 & Sändning & Rad 2 på skärm för armenheten \\ \hline
6 & Sändning & Rad 1 på skärm för chassienheten \\ \hline
7 & Sändning & Rad 2 på skärm för chassienheten \\ \hline
8 & Sändning & Vidarebefordra beslut från chassi till PC \\ \hline
9 & Sändning & Vidarebefordra RFID-tag till PC\\ \hline
10 & Sändning & Vidarebefordra data från sidoskanner till PC \\ \hline
11 & Sändning & Sätt Kp [nytt värde på Kp] \\ \hline
12 & Sändning & Sätt Kd [nytt värde på Kd] \\ \hline
13 & Sändning & Vidarebefordra kalibreringsvärde till PC \\ \hline
\end{tabularx}
\caption{ID:n samt funktion för delsystem kommunikation}
\end{table}

Delsystem arm

\begin{table}[H]
\centering
\label{callbacks-arm}
\begin{tabularx}{\textwidth}{|l|l|X|}
\hline
\textbf{ID} & \textbf{Sändning/förfrågan} & \textbf{Funktion [data]} \\ \hline
0 & Sändning & Nödstopp \\ \hline
1 & Sändning & Kommando till klo [0 = stäng, 1 = öppna] \\ \hline
2 & Sändning & Signal att roboten står på station [0 = vänster, 1 = höger] \\ \hline
3 & Sändning & Vinkel till upplockning [vinkel] \\ \hline
4 & Sändning & x koordinat till upplockning [x] \\ \hline
5 & Sändning & Plocka upp objekt [0 = inget hittades, 1 = föremål hittat] \\ \hline
6 & Sändning & x position för manuell styrning [x] \\ \hline
7 & Sändning & y position för manuell styrning [y] \\ \hline
8 & Sändning & Vinkel för manuell styrning om positiv [vinkel] \\ \hline
9 & Sändning & Vinkel för manuell styrning om negativ [vinkel] \\ \hline
10 & Sändning & Gå till position satt i manuell styrning \\ \hline
11 & Sändning & Uppdatera manuell styrning, se \ref{packets} \\ \hline
12 & Sändning & Lämna av objekt [0 = vänster, 1 = höger] \\ \hline
\end{tabularx}
\caption{ID:n samt funktion för delsystem arm}
\end{table}

\section{Protokoll för blåtand}
\begin{table}[H]
\label{packets}
\begin{tabularx}{\textwidth}{|l|X|X|}
\hline
\textbf{ID-beteckning} & \textbf{Beskrivning} & \textbf{Parametrar} \\ \hline
PKT\_STOP & Indikerar att roboten ska stoppa all rörelse. & Inga \\ \hline
PKT\_ARM\_COMMAND & Kommando till arm. & Kommando (1), argument (2-10) \\ \hline
PKT\_CHASSIS\_COMMAND & Kommando till chassi. & Kommando (1), argument (2-3) \\ \hline
PKT\_CALIBRATION\_COMMAND & Kommando för kalibrering av sensor. & Sensor id (1) \\ \hline
PKT\_LINE\_DATA & Data från linjesensorn. & Individuella sensorer (1-11), flaggor (12), tyngdpunkt (13), styrutslag (14) \\ \hline
PKT\_RANGE\_DATA & Avstånd från sidoskanner. & sida (1), avstånd (2-3) \\ \hline
PKT\_RFID\_DATA & Värde på RFID-tagg & värde (1) \\ \hline
PKT\_CHASSIS\_DECISION & Beslut från chassi. & beslut (1) \\ \hline
PKT\_PACKET\_REQUEST & Förfrågan om paket från dator. & ID på packet (1) \\ \hline
PKT\_SPOOFED\_REQUESE & Simulerad förfrågan över bussen & Adress för enheten som ska ta emot förfrågan (1), ID på funktionen som ska anropas(2), metadata som ska föras med förfrågan (3-4) \\ \hline
PKT\_SPOOFED\_RESPONSE & Svar på simulerad förfrågan. & Data som returneras av förfrågan (1-2) \\ \hline
PKT\_SPOOFED\_TRANSMIT & Simulerad sändning på bussen. & Data som skickas ut på bussen. (1-2) \\ \hline
PKT\_CALIBRATION\_DATA & Värde efter kalibrering. & Värde (1) \\ \hline
PKT\_LINE\_WEIGHT & Tyngdpunkt från linjesensor. & Tyngdpunkt (1) \\ \hline
\end{tabularx}
\caption{De olika pakettyper som kan skickas mellan roboten och PC och vad de innehåller. Parametrarnas ordningsnummer i parameterföljden anges inom parentes i den sista kolumnen.}
\end{table}

\begin{table}[H]
\label{commands}
\begin{tabularx}{\textwidth}{|l|X|X|}
\hline
\textbf{ID-beteckning} & \textbf{Beskrivning} & \textbf{Parametrar} \\ \hline
CMD\_ARM\_MOVE & Arm ska röra sig. & Koordinat (1), riktning (2) \\ \hline
CMD\_ARM\_GRIP & Stäng gripklo. & Inga \\ \hline
CMD\_ARM\_RELEASE & Öppna gripklo. & Inga \\ \hline
CMD\_ARM\_PREDEFINED\_POS & Rör arm till fördefinierad position. & ID på position \\ \hline
CMD\_ARM\_STOP & Stanna alla rörelser. & Inga \\ \hline
CMD\_ARM\_MOVE\_POS & Rör arm till position. & x (1), y (2), vinkel (3) \\ \hline
CMD\_CHASSIS\_START & Starta linjeföljning. & Inga \\ \hline
CMD\_CHASSIS\_STOP & Stoppa linjeföljning & Inga \\ \hline
CMD\_CHASSIS\_PARAMETERS & Sätt nya värde på $K_p$ och $K_d$. & $K_p$(1), $K_d$(2) \\ \hline
CMD\_CHASSIS\_MOVEMENT & Kommando till chassi att ändra sin hastighet eller riktning & Kommando (1) \\ \hline
\end{tabularx}
\caption{De olika undertyper av paket som skickas som kommandon från persondatorgränssnittet till roboten, genom PKT\_ARM\_COMMAND eller PKT\_CHASSIS\_COMMAND. Parametrarnas ordningsnummer i parameterföljden anges inom parentes i den sista kolumnen.}
\end{table}

\begin{table}[H]
\label{decision}
\begin{tabularx}{\textwidth}{|l|X|}
\hline
\textbf{ID-beteckning} & \textbf{Beskrivning} \\ \hline
DEC\_PICKUP\_RIGHT & Plockar upp föremål höger. \\ \hline
DEC\_PICKUP\_LEFT & Plockar upp föremål vänster. \\ \hline
DEC\_PUT\_DOWN\_RIGHT & Lägger ner föremål höger. \\ \hline
DEC\_PUT\_DOWN\_LEFT & Lägger ner föremål vänster.  \\ \hline
DEC\_NO\_MATCH & RFID var inte korrekt.  \\ \hline
DEC\_STATION\_HANDLED & Station redan behandlad.  \\ \hline
DEC\_NO\_ID\_FOUND & Ingen RFID-tagg hittade på stationen.  \\ \hline
DEC\_ARM\_PICKED\_UP & Arm har plockat upp ett föremål. \\ \hline
DEC\_ARM\_PUT\_DOWN & Arm har lagt ned ett föremål. \\ \hline
DEC\_OBJECT\_NOT\_FOUND & Inget föremål hittades. \\ \hline
DEC\_UNKNOWN\_ERROR & Okänt fel inträffade. \\ \hline
DEC\_ARM\_FAILED & Arm misslyckades med upplockning. \\ \hline
DEC\_START\_LINE & Startade linjeföljning. \\ \hline
\end{tabularx}
\caption{De olika besluten som roboten kan ta och vidarebefordra till persondatorgränssnittet.}
\end{table}

\section{Övriga bilagor?}
